"use strict";(self["webpackChunknvs_v5"]=self["webpackChunknvs_v5"]||[]).push([[2986],{7011:function(t,e,a){a.r(e),a.d(e,{default:function(){return k}});var s=a(4177),l=a(7179),i=a(3385),o=a(5223),n=a(4437),r=a(6035),d=a(9841),c=a(7345),u=a(6904),p=a(5057),h=a(1908),m=a(8421),f=a(1302),A=a(5294),g=a(6883),v=a(5234),D=a(5251),S=function(){var t=this,e=t._self._c;return e("div",[e(r.Z,[e(A.Z,[e(n.Z,{attrs:{cols:"12"}},[e(i.Z,{staticClass:"mx-auto",attrs:{"max-width":"650"}},[e(u.Z,[e(o.EB,[e("span",{staticClass:"text-h4 text-md-h3"},[t._v("Relatório de Frota")])]),e(o.ZB,[e(r.Z,[e(A.Z,{attrs:{justify:"center"}},[e(n.Z,{attrs:{cols:"12",sm:"6",md:"12"}},[e(s.Z,{staticClass:"grey-label",attrs:{items:t.plates,color:"blue",outlined:"","hide-details":"",label:"Placa","prepend-icon":"mdi-account-outline","item-text":"PLACA","item-value":"PLACA",onkeyup:"this.value = this.value.toUpperCase()"},on:{mouseover:function(e){0==t.plates.length&&t.fetchPlates()}},scopedSlots:t._u([{key:"no-data",fn:function(){return[e(h.Z,[e(m.V9,[t._v(" Nenhum item encontrado "),e("br"),e("br"),e(f.Z,{attrs:{indeterminate:"",color:"blue"}})],1)],1)]},proxy:!0}]),model:{value:t.plate,callback:function(e){t.plate=e},expression:"plate"}})],1),e(n.Z,{attrs:{cols:"12",md:"6"}},[e(s.Z,{staticClass:"grey-label",attrs:{items:t.plates,color:"blue","hide-details":"","prepend-icon":"mdi-map-marker-outline",label:"Estado",placeholder:"Selecione",outlined:"","item-text":"ESTADO","item-value":"ESTADO"},on:{mouseover:function(e){0==t.plates.length&&t.fetchPlates()}},model:{value:t.state,callback:function(e){t.state=e},expression:"state"}})],1),e(n.Z,{attrs:{cols:"12",md:"6"}},[e(g.Z,{staticClass:"grey-label",attrs:{color:"blue","prepend-icon":"mdi-list-status","hide-details":"",multiple:"",items:t.licenceHeaders,label:"Status",placeholder:"Selecione",outlined:""},model:{value:t.status,callback:function(e){t.status=e},expression:"status"}})],1),e(n.Z,{attrs:{cols:"12",sm:"6"}},[e(D.Z,{staticClass:"my-0 ms-2 pa-0",attrs:{readonly:"",outlined:"","hide-details":"","max-width":"100",label:"Início"},model:{value:t.computedDateFormatted1,callback:function(e){t.computedDateFormatted1=e},expression:"computedDateFormatted1"}}),e(c.Z,{staticClass:"ma-0 pa-0 mx-auto",attrs:{color:"amber",locale:"pt-BR","no-title":""},model:{value:t.date1,callback:function(e){t.date1=e},expression:"date1"}})],1),e(n.Z,{attrs:{cols:"12",sm:"6"}},[e(D.Z,{staticClass:"my-0 ms-2 pa-0",attrs:{readonly:"",outlined:"","hide-details":"","max-width":"100",label:"Final"},model:{value:t.computedDateFormatted2,callback:function(e){t.computedDateFormatted2=e},expression:"computedDateFormatted2"}}),e(c.Z,{staticClass:"ma-0 pa-0 mx-auto",attrs:{color:"amber",locale:"pt-BR","no-title":""},model:{value:t.date2,callback:function(e){t.date2=e},expression:"date2"}})],1)],1)],1)],1),e(o.h7,{staticClass:"mt-n10 px-10 py-5"},[e(l.Z,{attrs:{fab:"",small:"",disabled:!t.licences,loading:t.loading2},on:{click:function(e){return t.downloadPDF()}}},[e(p.Z,{attrs:{dark:"",color:"red darken-2"}},[t._v(" mdi-file-pdf-box ")])],1),e(l.Z,{attrs:{fab:"",small:"",disabled:!t.licences,loading:t.loading3},on:{click:function(e){return t.downloadXLSX("xlsx")}}},[e(p.Z,{attrs:{dark:"",color:"green darken-2"}},[t._v(" mdi-microsoft-excel ")])],1),e(v.Z),e(l.Z,{attrs:{color:"blue darken-3 white--text",loading:t.loading},on:{click:function(e){t.generateReport(),t.loading=!0}}},[t._v(" Gerar Relatório ")])],1)],1)],1)],1)],1),e(A.Z,[!0===t.showReport?e(r.Z,[e(d.Z,{attrs:{headers:t.headers,items:t.licences,"footer-props":{itemsPerPageOptions:[5,10,-1]}}})],1):t._e()],1)],1),e("vue-html2pdf",{ref:"html2Pdf",attrs:{"show-layout":!1,"enable-download":!0,"manual-pagination":!1,"paginate-elements-by-height":14001,filename:t.reportName,"pdf-quality":2,"pdf-format":"a4","pdf-orientation":"landscape","pdf-content-width":"100%"},on:{startPagination:function(e){t.loading2=!0},hasDownloaded:function(e){t.loading2=!1}}},[e("section",{attrs:{slot:"pdf-content"},slot:"pdf-content"},[!0===t.showReport?e(r.Z,[e(d.Z,{attrs:{headers:t.headers,items:t.licences,"footer-props":{itemsPerPageOptions:[-1]}}})],1):t._e()],1)]),e("table",{directives:[{name:"show",rawName:"v-show",value:!1,expression:"false"}],ref:"exportableTable"},[e("tr",t._l(t.headers,(function(a,s){return e("th",{key:"header"+s},[t._v(" "+t._s(a.text)+" ")])})),0),t._l(t.licences,(function(a,s){return e("tr",{key:"data"+s},[e("td",[t._v(t._s(t.usDate(a.DATA)))]),e("td",[t._v(t._s(a.SOLICITANTE))]),e("td",[t._v(t._s(a.EMPRESA))]),e("td",[t._v(t._s(a.ESTADO))]),e("td",[t._v(t._s(a.PLACA))]),e("td",[t._v(t._s(a.NUMTAXA))])])}))],2)],1)},b=[],T=a(5121),x=a(2074),Z=a(4105),E={name:"FleetReport",components:{VueHtml2pdf:x.Z},data:()=>({company:"",state:"",plate:"",status:"",table:"",dateFormatted:"",reportName:"",showReport:!1,licences:null,loading:!1,loading2:!1,loading3:!1,date1:new Date((new Date).getFullYear(),(new Date).getMonth(),1).toISOString().substr(0,10),date2:new Date(Date.now()-6e4*(new Date).getTimezoneOffset()).toISOString().substr(0,10),companies:[],plates:[],states:[],headers:[{text:"ID",value:"ID"},{text:"Placa",value:"PLACA"},{text:"UF",value:"ESTADO"},{text:"AET",value:"AET"},{text:"Emissão",value:"EMISSÃO"},{text:"Vencimento",value:"VENCIMENTO"},{text:"Status",value:"STATUSAET"}],licenceHeaders:[{text:"Vencida",value:"VENCIDA"},{text:"Válida",value:"VALIDA"},{text:"Vencimento próximo",value:"Vence em"}]}),computed:{razaoSocial(){return window.sessionStorage.razaosocial},computedDateFormatted1(){return this.formatDate(this.date1)},computedDateFormatted2(){return this.formatDate(this.date2)}},watch:{date1(){this.dateFormatted=this.formatDate(this.date1)},date2(){this.dateFormatted=this.formatDate(this.date2)},licences(){return this.reportName="Relatório NVS "+this.date2}},created(){},methods:{fetchPlates(){fetch("https://sheetdb.io/api/v1/afxq0nl1f0gvg").then((t=>t.json())).then((t=>{this.companies=t})).then((()=>{let t=this.companies.filter((t=>this.razaoSocial===t.EMPRESA));this.plates=t,console.log(this.plates)}))},formatDate(t){if(!t)return null;var[e,a,s]=t.split("-");return`${s.padStart(2,"0")}/${a.padStart(2,"0")}/${e}`},parseDate(t){if(!t)return null;const[e,a,s]=t.split("/");return`${s}-${a.padStart(2,"0")}-${e.padStart(2,"0")}`},usDate(t){if(!t)return null;const[e,a,s]=t.split("/");var l="00:00:28";return`${a.padStart(2,"0")}/${e.padStart(2,"0")}/${s} ${l}`},fetchLicences(){return T.Z.get("https://sheetdb.io/api/v1/afxq0nl1f0gvg")},generateReport(){this.fetchLicences().then((t=>{var e=t.data;this.$nextTick((()=>{var t="",a="",s="",l="";t=e.filter((t=>t.EMPRESA.includes(this.company)&&t.PLACA.includes(this.plate)&&t.ESTADO.includes(this.state)&&t.STATUSAET.includes(this.status)&&this.parseDate(t.DATA).replace(/-/g,"")>=this.date1.replace(/-/g,"")&&this.parseDate(t.DATA).replace(/-/g,"")<=this.date2.replace(/-/g,""))),a=e.filter((t=>t.EMPRESA.includes(this.company)&&t.PLACA.includes(this.plate)&&t.ESTADO.includes(this.state)&&t.STATUSAET.includes(this.status[0])&&this.parseDate(t.DATA).replace(/-/g,"")>=this.date1.replace(/-/g,"")&&this.parseDate(t.DATA).replace(/-/g,"")<=this.date2.replace(/-/g,""))),s=e.filter((t=>t.EMPRESA.includes(this.company)&&t.PLACA.includes(this.plate)&&t.ESTADO.includes(this.state)&&t.STATUSAET.includes(this.status[1])&&this.parseDate(t.DATA).replace(/-/g,"")>=this.date1.replace(/-/g,"")&&this.parseDate(t.DATA).replace(/-/g,"")<=this.date2.replace(/-/g,""))),l=e.filter((t=>t.EMPRESA.includes(this.company)&&t.PLACA.includes(this.plate)&&t.ESTADO.includes(this.state)&&t.STATUSAET.includes(this.status[2])&&this.parseDate(t.DATA).replace(/-/g,"")>=this.date1.replace(/-/g,"")&&this.parseDate(t.DATA).replace(/-/g,"")<=this.date2.replace(/-/g,""))),0===this.status.length?this.licences=t:this.licences=a.concat(s).concat(l),this.showReport=!0,this.loading=!1}))}))},downloadPDF(){this.$refs.html2Pdf.generatePdf()},downloadXLSX(t,e,a){var s=this.$refs.exportableTable,l=Z.P6.table_to_book(s,{sheet:"Relatório"});this.loading3=!0,setTimeout((()=>(this.loading3=!1,a?Z.cW(l,{bookType:t,bookSTT:!0,type:"string"}):Z.NC(l,e||this.reportName+"."+(t||"xlsx")))),100)}}},w=E,P=a(1001),_=(0,P.Z)(w,S,b,!1,null,null,null),k=_.exports}}]);
//# sourceMappingURL=views-FleetReport.b9c284e3.js.map